{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": {"url": "data/poverty_state.csv"},
  "params": [
    {
        "name": "select_indicator", 
        "value": "financial_gap", 
        "bind": {
            "input": "select", 
            "options": ["financial_gap","income", "expenditure"], 
            "labels": ["Financial Gap","Income Level", "Expenditure Level"], 
            "name": "Indicator Selection: "
        }
    }
  ],
  "transform": [
    {"filter": "datum.state != 'Kuala Lumpur'"}, 
    {
        "calculate": "select_indicator == 'financial_gap' ? datum.financial_gap : (select_indicator == 'income' ? datum.income_mean : datum.expenditure_mean)",
        "as": "value"
    }, 
    {
        "calculate": "select_indicator == 'financial_gap' ? 'Financial Gap' : (select_indicator == 'income' ? 'Average Income' : 'Average Expenditure')",
        "as": "label"
    }
  ],
  "width": 562, 
  "height": 380,
  "layer": [
    {
      "mark": {"type": "circle"}, 
      "encoding": {
        "x": {
            "field": "value", 
            "type": "quantitative", 
            "title": "Financial Gap / Income / Expenditure", 
            "scale": {
                "domain": {"expr": "select_indicator == 'financial_gap' ? [1000, 6000] : (select_indicator == 'income' ? [4000, 10000] : [2500, 7500])"}
            }, 
            "axis": {
              "titleFontSize": 13, 
              "labelFontSize": 11, 
              "labelColor": "#656565",
              "labelFont": "Open Sans",
              "titleFont": "Open Sans"
            }
        }, 
        "y": {
            "field": "poverty", 
            "type": "quantitative", 
            "title": "Poverty Rate (%)",
            "axis": {
              "titleFontSize": 13, 
              "labelFontSize": 11, 
              "labelColor": "#656565",
              "labelFont": "Open Sans",
              "titleFont": "Open Sans"
            }
        }, 
        "size": {"value": 130}, 
        "tooltip": [
            {"field": "state", "type": "nominal", "title": "State"}, 
            {"field": "label", "type": "nominal", "title": "Indicator"},
            {"field": "value", "type": "quantitative", "title": "Value"},
            {"field": "poverty", "type": "quantitative", "title": "Poverty Rate (%)"}
        ]
      }
    },
    {
      "transform": [
        {"filter": "select_indicator == 'financial_gap'"},
        {
          "regression": "poverty",
          "on": "value",
          "extent": [1000,6000]
        }
      ],
      "mark": {
        "type": "line",
        "color": "red",
        "strokeWidth": 2
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative"
        },
        "y": {
          "field": "poverty",
          "type": "quantitative"
        }
      }
    },
    {
      "transform": [
        {"filter": "select_indicator == 'income'"},
        {
          "regression": "poverty",
          "on": "value",
          "extent": [4000,10000]
        }
      ],
      "mark": {
        "type": "line",
        "color": "red",
        "strokeWidth": 2
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative"
        },
        "y": {
          "field": "poverty",
          "type": "quantitative"
        }
      }
    },
    {
      "transform": [
        {"filter": "select_indicator == 'expenditure'"},
        {
          "regression": "poverty",
          "on": "value",
          "extent": [2500,7500]
        }
      ],
      "mark": {
        "type": "line",
        "color": "red",
        "strokeWidth": 2
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative"
        },
        "y": {
          "field": "poverty",
          "type": "quantitative"
        }
      }
    }, 
    {
      "transform": [
        {"filter": "datum.state == 'Sabah'"}
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 10,
        "dy": -1,
        "fontSize":12,
        "font": "Open Sans"
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative"
        },
        "y": {
          "field": "poverty",
          "type": "quantitative"
        },
        "text": {"value": "Sabah"}
      }
    }
  ]
}

